# scripts/raw_cls 解析

这里存放 **raw_cls（修复体类别分类）** 相关的“可复用模块”，目标是把巨大的训练脚本拆成：

- 更短的入口（CLI 脚本负责解析参数和调度）
- 更清晰的模块（dataset / 特征 / 增广 / loss / eval）

## 你通常从哪里开始看？

- 想知道 **输入怎么变成张量**：先看 `dataset.py` + `preprocess_np.py`
- 想知道 **点特征怎么构造**：看 `features.py`
- 想知道 **评估指标/报表**：看 `metrics.py` + `eval.py`
- 想知道 **loss/对比学习/域对齐**：看 `losses.py`
- 想知道 **训练时增广**：看 `augment.py`

## 文件地图（按职责）

- `preprocess_np.py`：点云（numpy）预处理：中心化、归一化、PCA 对齐、rotate/jitter/dropout
- `features.py`：点特征构造：xyz/normals/curv/radius/rgb/cloud_id
- `dataset.py`：`RawClsDataset`（含 feature cache 与 cloud-aware subsample）
- `metrics.py`：confusion + macro_f1/balanced_acc 等
- `eval.py`：评估（含 TTA rotate_z）、校准指标、CSV 导出
- `losses.py`：CE（per-sample）、SupCon、CORAL
- `augment.py`：训练时 torch 增广（不破坏 cloud_id 等非几何通道）

## 常见问题

- “全冠 vs 桩核冠”这类歧义，更多是 **数据/标签/输入表征** 的问题：先从 `dataset.py`（meta、objects_used、extra_features）和 `features.py`（是否加入 curv/radius 等几何）定位。
